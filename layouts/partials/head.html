<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- TODO update this section -->

<!-- Favicon  -->
<link rel="icon" href="{{ .Site.Params.meta.favicon_ico }}" sizes="any">
<link rel="icon" href="{{ .Site.Params.meta.favicon_svg }}" type="image/svg+xml">

<!-- Apple Touch icons for iOS and Windows shortcut -->
<link rel="apple-touch-icon" href="{{ .Site.Params.meta.favicon_96 }}">
<link rel="apple-touch-icon" sizes="192x192" href="/favicon/web-app-manifest-192x192.png">
<link rel="apple-touch-icon" sizes="512x512" href="/favicon/web-app-manifest-512x512.png">

<!-- Web App Manifest for PWA installation -->
<link rel="manifest" href="{{ .Site.Params.meta.manifest }}">

<!-- Theme and tile metadata -->
<meta name="theme-color" content="{{ .Site.Params.meta.theme_color }}">
<meta name="background-color" content="{{ .Site.Params.meta.background_color }}">
<meta name="msapplication-TileImage" content="/favicon/web-app-manifest-192x192.png">
<meta name="msapplication-TileColor" content="{{ .Site.Params.meta.background_color }}">

<!--
  - Include the "meta" partial template, which contains SEO and social media meta tags
  - Passing current context (.) so partial can access site/page variables -->
{{ partial "meta" . }}

{{/* Hide Alpine.js [x-cloak] elements until Alpine initializes to prevent nav menu flicker.
     The x-cloak directive is located in the head partial to prevent rollup from Vite. */}}
<style>
    [x-cloak] { display: none !important; }
</style>

<script>
    // On page load or when changing themes, best to add inline in `head` to avoid FOUC
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark')
    }
</script>

{{/* Use Vite-generated CSS files with cache busting hashes */}}
{{ $cssFiles := readDir "static/css" }}
{{ $mainCSS := "" }}
{{ range $cssFiles }}
  {{ if strings.Contains .Name "main." }}
    {{ if strings.HasSuffix .Name ".css" }}
      {{ $mainCSS = .Name }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if $mainCSS }}
	<link rel="stylesheet" href="/css/{{ $mainCSS }}" />
{{ else }}

	<!--  
	  - Get the main stylesheet from Hugoâ€™s assets pipeline 
	  - Path is relative to the /assets directory (NOT /static)
	  - Process it through PostCSS -->
	{{ $styles := resources.Get "/css/style.css" | postCSS }}

	<!-- 
	  - Minify: f production build to deploy reduced size files
	  - Fingerprint: append hash to files for cache busting -->
	{{ if hugo.IsProduction }}
	    {{ $styles = $styles | minify | fingerprint | resources.PostProcess }}
	{{ else }}
	    {{ $styles = $styles | fingerprint | resources.PostProcess }}
	{{ end }}

	<!--
	 - Link to the compiled CSS file with Subresource Integrity (SRI) hash 
	 - RelPermalink: the versioned URL of the processed CSS file
	 - integrity: cryptographic hash for browser to verify file wasn't altered -->
	<link rel="stylesheet" href="{{ $styles.RelPermalink }}" integrity="{{ $styles.Data.Integrity }}" />

{{ end }}
