<meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Favicon (browser tabs) -->
<link rel="icon" href="{{ .Site.Params.meta.favicon_ico }}" type="image/x-icon">
<link rel="icon" href="{{ .Site.Params.meta.favicon_svg }}" type="image/svg+xml" sizes="any">
<link rel="mask-icon" href="{{ .Site.Params.meta.favicon_svg }}" color="{{ .Site.Params.meta.theme_color }}" sizes="any">

<!-- Theme and tile metadata -->
<meta name="theme-color" content="{{ .Site.Params.meta.theme_color }}">
<meta name="background-color" content="{{ .Site.Params.meta.background_color }}">

<!-- Apple Touch icons for iOS and Windows shortcut -->
<link rel="apple-touch-icon" sizes="96x96" href="{{ .Site.Params.meta.favicon_96 }}">
<link rel="apple-touch-icon" sizes="192x192" href="{{ .Site.Params.meta.web_am_192 }}">

<!-- Manifest (Android / Chrome PWA) -->
<link rel="manifest" href="{{ .Site.Params.meta.manifest }}">

<!-- Windows tiles -->
<meta name="msapplication-TileImage" content="{{ .Site.Params.meta.favicon_150 }}">
<meta name="msapplication-TileColor" content="{{ .Site.Params.meta.background_color }}">

<!--
  - Include the "meta" partial template, which contains SEO and social media meta tags
  - Passing current context (.) so partial can access site/page variables -->
{{ partial "meta" . }}

{{/* DNS prefetch and preconnect for external resources */}}
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
{{ if .Site.Params.social_franchising.buy_me_a_coffee.enabled }}
  <link rel="dns-prefetch" href="//cdnjs.buymeacoffee.com">
  <link rel="preconnect" href="https://cdnjs.buymeacoffee.com" crossorigin>
{{ end }}


{{/* Hide Alpine.js [x-cloak] elements until Alpine initializes to prevent nav menu flicker.
     The x-cloak directive is located in the head partial to prevent rollup from Vite. */}}
<style>
    [x-cloak] { display: none !important; }
</style>

<script>
    // On page load or when changing themes, best to add inline in `head` to avoid FOUC
    if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark')
    }
</script>

{{/* Use Vite-generated CSS files with cache busting hashes */}}
{{ $cssFiles := readDir "static/css" }}
{{ $mainCSS := "" }}
{{ range $cssFiles }}
  {{ if strings.Contains .Name "main." }}
    {{ if strings.HasSuffix .Name ".css" }}
      {{ $mainCSS = .Name }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if $mainCSS }}
  <link rel="stylesheet" href="/css/{{ $mainCSS }}">
{{ else }}
  <!-- Fallback to Hugo PostCSS processing if Vite file not found -->
  {{ $styles := resources.Get "css/main.css" | postCSS }}
  {{ if hugo.IsProduction }}
    {{ $styles = $styles | minify | fingerprint | resources.PostProcess }}
  {{ else }}
    {{ $styles = $styles | fingerprint | resources.PostProcess }}
  {{ end }}
	
  <link rel="stylesheet" href="{{ $styles.RelPermalink }}">
{{ end }}
