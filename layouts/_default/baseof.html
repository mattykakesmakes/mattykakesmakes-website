<!DOCTYPE html>
<html lang="{{ .Language.Lang }}">

<head>
    {{ partial "head.html" . }}
</head>

<body class="bg-zinc-100 dark:bg-gray-800">
    {{ partial "nav.html" . }}
    {{ block "main" . }}{{ end }}
    {{ partial "footer" . }}

    {{/* Load JavaScript asynchronously to prevent main thread blocking */}}
    {{ if not .Site.Params.Disable_theme_toggle }}
    {{ $js := resources.Get "js/darkmode.js" | js.Build }}
    <script defer src="{{ $js.RelPermalink }}"></script>
    {{ end }}
    

    {{/* Load Alpine.js with defer to prevent blocking but load the CDN version with onerror,
       * and keep a hidden local copy built with Hugo Pipes. If the CDN fails or youâ€™re offline,
       * the local one kicks in automatically. */}}
    {{ $alpine := resources.Get "js/alpine.min.js" | fingerprint }}
    <script id="alpine-local" src="{{ $alpine.RelPermalink }}" defer hidden></script>

    {{/* Try CDN first, fallback to local on error */}}
    <script defer 
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
            onerror="document.getElementById('alpine-local').removeAttribute('hidden');">
    </script>
</body>

</html>